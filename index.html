<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>90-Day Exercise Tracker</title>

  <!-- React + Babel -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind (CDN for quick dev) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase compat libraries -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // âš ï¸ REPLACE WITH YOUR FIREBASE CONFIG âš ï¸
    const firebaseConfig = {
      apiKey: "AIzaSyDflVWpWRaM79otPlFdgY9Jj2_TT8coP8c",
      authDomain: "workout-tracker-cf45f.firebaseapp.com",
      projectId: "workout-tracker-cf45f",
      storageBucket: "workout-tracker-cf45f.appspot.com",
      messagingSenderId: "557876111419",
      appId: "1:557876111419:web:621155c84179128c89541e"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.firestore();
    const auth = firebase.auth();

    const Icon = ({ children, className = "w-5 h-5" }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" xmlns="http://www.w3.org/2000/svg">
        {children}
      </svg>
    );

    const Calendar = (p) => <Icon {...p}><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></Icon>;
    const TrendingUp = (p) => <Icon {...p}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></Icon>;
    const Dumbbell = (p) => <Icon {...p}><path d="M2 12h2"/><path d="M20 12h2"/><path d="M6 8l12 8"/><path d="M6 16l12-8"/></Icon>;
    const Clock = (p) => <Icon {...p}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></Icon>;
    const Play = (p) => <Icon {...p} className="w-4 h-4"><polygon points="5 3 19 12 5 21 5 3"/></Icon>;
    const RotateCcw = (p) => <Icon {...p}><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></Icon>;
    const Save = (p) => <Icon {...p}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></Icon>;
    const Trash2 = (p) => <Icon {...p} className="w-4 h-4"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M10 11v6"/><path d="M14 11v6"/></Icon>;
    const Edit2 = (p) => <Icon {...p} className="w-4 h-4"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></Icon>;
    const Plus = (p) => <Icon {...p} className="w-4 h-4"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></Icon>;
    const LogOut = (p) => <Icon {...p}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></Icon>;
    const BarChart = (p) => <Icon {...p}><line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/></Icon>;

    const EXERCISES = {
      bicepTricep: [
        { name: 'Barbell Curl', sets: 3, reps: 12, instructions: 'Stand with feet shoulder-width, grip barbell at shoulder-width, curl slowly keeping elbows tucked, pause at top, lower with control.', videoUrl: 'https://www.youtube.com/embed/GNO4OtYoCYk?start=171' },
        { name: 'Close-Grip Bench Press', sets: 4, reps: 12, instructions: 'Lie on bench, grip barbell narrower than shoulder-width, lower to mid-chest, press up powerfully, keep elbows close to body.', videoUrl: 'https://www.youtube.com/embed/GNO4OtYoCYk?start=614' },
        { name: 'Weighted Chin-Up (Supinated Grip)', sets: 3, reps: 12, instructions: 'Use supinated grip, hang with full stretch, pull up until chin over bar, lower slowly to avoid swinging.', videoUrl: 'https://www.youtube.com/embed/eGo4IYlbE5g?start=330' },
        { name: 'Dumbbell Preacher Curl', sets: 4, reps: 12, instructions: 'Sit at preacher bench, arm fully extended, curl dumbbell up, squeeze at top, lower slowly to full stretch.', videoUrl: 'https://www.youtube.com/embed/GNO4OtYoCYk?start=265' },
        { name: 'Overhead Dumbbell Triceps Extension', sets: 3, reps: 12, instructions: 'Hold dumbbell overhead with both hands, lower behind head keeping elbows high, extend arms fully, avoid flaring elbows.', videoUrl: 'https://www.youtube.com/embed/GNO4OtYoCYk?start=524' },
        { name: 'EZ Bar Reverse Curl', sets: 3, reps: 12, instructions: 'Grip EZ bar overhand, curl up keeping wrists straight, pause at top, lower slowly to target brachioradialis.', videoUrl: 'https://www.youtube.com/embed/GNO4OtYoCYk?start=489' }
      ],
      chest: [
        { name: 'Barbell Bench Press', sets: 4, reps: 12, instructions: 'Lie flat, grip barbell slightly wider than shoulders, lower to mid-chest, press up, keep scapulae retracted.', videoUrl: 'https://www.youtube.com/embed/OZb-1z3gTeg?start=180' },
        { name: 'Incline Dumbbell Press', sets: 3, reps: 12, instructions: 'Set bench to 30-45Â°, hold dumbbells, press up while keeping slight arch in back, lower to chest level.', videoUrl: 'https://www.youtube.com/embed/OZb-1z3gTeg?start=300' },
        { name: 'Weighted Dips', sets: 3, reps: 12, instructions: 'Lean slightly forward, lower until shoulders below elbows, push up, keep core tight to target chest.', videoUrl: 'https://www.youtube.com/embed/OZb-1z3gTeg?start=420' },
        { name: 'Cable Crossover', sets: 3, reps: 12, instructions: 'Set cables above shoulders, pull handles down and across body, squeeze chest at peak, return with stretch.', videoUrl: 'https://www.youtube.com/embed/OZb-1z3gTeg?start=510' }
      ],
      back: [
        { name: 'Deadlift', sets: 4, reps: 12, instructions: 'Feet hip-width, grip barbell outside knees, keep back flat, pull up, thrust hips forward, lower with control.', videoUrl: 'https://www.youtube.com/embed/eGo4IYlbE5g?start=120' },
        { name: 'Weighted Pull-Up', sets: 3, reps: 12, instructions: 'Use overhand grip, hang fully, pull up until chin over bar, lower slowly to maximize lat activation.', videoUrl: 'https://www.youtube.com/embed/eGo4IYlbE5g?start=330' },
        { name: 'Barbell Row', sets: 3, reps: 12, instructions: 'Hinge at hips, grip barbell, pull to lower ribs, keep back parallel to ground, avoid jerking.', videoUrl: 'https://www.youtube.com/embed/eGo4IYlbE5g?start=240' },
        { name: 'Seated Cable Row', sets: 3, reps: 12, instructions: 'Sit upright, pull cable handle to mid-torso, retract scapulae, keep elbows close, return with stretch.', videoUrl: 'https://www.youtube.com/embed/eGo4IYlbE5g?start=450' }
      ],
      shoulders: [
        { name: 'Overhead Barbell Press', sets: 4, reps: 12, instructions: 'Stand or sit, grip barbell at shoulder-width, press overhead, lock out arms, lower to collarbone level.', videoUrl: 'https://www.youtube.com/embed/TLsT097v1dc?start=150' },
        { name: 'Dumbbell Lateral Raise', sets: 4, reps: 12, instructions: 'Stand with dumbbells at sides, raise to shoulder height, slight bend in elbows, lower with control.', videoUrl: 'https://www.youtube.com/embed/TLsT097v1dc?start=270' },
        { name: 'Rear Delt Fly (Dumbbell)', sets: 3, reps: 12, instructions: 'Bend forward, hold dumbbells, raise arms outward, squeeze rear delts, keep movement controlled.', videoUrl: 'https://www.youtube.com/embed/TLsT097v1dc?start=390' },
        { name: 'Face Pull', sets: 3, reps: 12, instructions: 'Set cable at face height, pull rope to ears, elbows high, squeeze rear delts, avoid shrugging.', videoUrl: 'https://www.youtube.com/embed/TLsT097v1dc?start=510' }
      ],
      legs: [
        { name: 'Barbell Squat', sets: 4, reps: 12, instructions: 'Bar on upper traps, feet shoulder-width, squat to knee depth, keep chest up, drive through heels.', videoUrl: 'https://www.youtube.com/embed/ZOQUNh3sK1M?start=180' },
        { name: 'Romanian Deadlift', sets: 3, reps: 12, instructions: 'Hold barbell, hinge at hips, lower to mid-shin, keep back flat, pull up using hamstrings.', videoUrl: 'https://www.youtube.com/embed/ZOQUNh3sK1M?start=300' },
        { name: 'Bulgarian Split Squat', sets: 3, reps: 12, instructions: 'Rear foot elevated, front foot forward, lower until front thigh parallel, push through front heel.', videoUrl: 'https://www.youtube.com/embed/ZOQUNh3sK1M?start=420' },
        { name: 'Leg Press', sets: 3, reps: 12, instructions: 'Feet shoulder-width on platform, lower until knees at 90Â°, push through heels, avoid locking knees.', videoUrl: 'https://www.youtube.com/embed/ZOQUNh3sK1M?start=540' }
      ]
    };

    const DEFAULT = {
      bicepTricep: { name: 'Bicep & Tricep', exercises: [ EXERCISES.bicepTricep[0], EXERCISES.bicepTricep[1], EXERCISES.bicepTricep[3] ] },
      chest: { name: 'Chest', exercises: [ EXERCISES.chest[0], EXERCISES.chest[1] ] },
      back: { name: 'Back', exercises: [ EXERCISES.back[0], EXERCISES.back[1] ] },
      shoulders: { name: 'Shoulders', exercises: [ EXERCISES.shoulders[0], EXERCISES.shoulders[1] ] },
      legs: { name: 'Legs', exercises: [ EXERCISES.legs[0], EXERCISES.legs[1] ] }
    };

    function App() {
      const [user, setUser] = useState(null);
      const [loading, setLoading] = useState(true);
      const [templates, setTemplates] = useState(DEFAULT);
      const [workouts, setWorkouts] = useState([]);
      const [view, setView] = useState('home');
      const [editing, setEditing] = useState(null);
      const [editingWorkout, setEditingWorkout] = useState(null);
      const [workout, setWorkout] = useState(null);
      const [resumingWorkout, setResumingWorkout] = useState(false);
      const [timer, setTimer] = useState({ time: 90, left: 0, active: false });
      const [showNew, setShowNew] = useState(false);
      const [newEx, setNewEx] = useState({ name: '', sets: 3, reps: 10, instructions: '', videoUrl: '' });
      const [editEx, setEditEx] = useState(null);
      const [video, setVideo] = useState(null);
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [authMode, setAuthMode] = useState('login');
      const [showNewTemplate, setShowNewTemplate] = useState(false);
      const [newTemplate, setNewTemplate] = useState({ name: '', exercises: [] });

      useEffect(() => {
        const unsub = auth.onAuthStateChanged((u) => {
          setUser(u);
          setLoading(false);
          if (u) loadData(u.uid);
        });
        return () => unsub();
      }, []);

      const loadData = async (uid) => {
        try {
          const templDoc = await db.collection('users').doc(uid).collection('data').doc('templates').get();
          if (templDoc.exists) {
            setTemplates(templDoc.data().templates || DEFAULT);
          } else {
            // persist a default copy if no templates yet
            await db.collection('users').doc(uid).collection('data').doc('templates').set({
              templates: DEFAULT,
              updated: new Date().toISOString()
            });
            setTemplates(DEFAULT);
          }

          const ninetyDaysAgo = new Date();
          ninetyDaysAgo.setDate(ninetyDaysAgo.getDate() - 90);

          const workoutsSnapshot = await db.collection('users').doc(uid).collection('workouts')
            .where('start', '>=', ninetyDaysAgo.toISOString())
            .orderBy('start', 'desc')
            .limit(200)
            .get();

          const ws = [];
          workoutsSnapshot.forEach(doc => ws.push({ id: doc.id, ...doc.data() }));
          setWorkouts(ws);
        } catch (err) {
          console.error('loadData error', err);
        }
      };

      const saveTemplates = async (newTemplates) => {
        if (!user) return;
        try {
          await db.collection('users').doc(user.uid).collection('data').doc('templates').set({
            templates: newTemplates,
            updated: new Date().toISOString()
          });
          setTemplates(newTemplates);
        } catch (err) {
          console.error('saveTemplates', err);
          alert('Error saving templates');
        }
      };

      const deleteTemplate = async (key) => {
        if (!user || !confirm('Delete this template?')) return;
        const clone = { ...templates };
        delete clone[key];
        await saveTemplates(clone);
      };

      const saveWorkoutToDb = async (workoutData) => {
        if (!user) return;
        try {
          await db.collection('users').doc(user.uid).collection('workouts').add({
            ...workoutData,
            created: new Date().toISOString()
          });
          loadData(user.uid);
        } catch (err) {
          console.error('saveWorkoutToDb', err);
          alert('Error saving workout');
        }
      };

      const saveWorkoutProgress = async (workoutData, workoutId = null) => {
        if (!user) return;
        try {
          if (workoutId) {
            await db.collection('users').doc(user.uid).collection('workouts').doc(workoutId).update({
              ...workoutData,
              updated: new Date().toISOString()
            });
          } else {
            await db.collection('users').doc(user.uid).collection('workouts').add({
              ...workoutData,
              inProgress: true,
              created: new Date().toISOString()
            });
          }
          loadData(user.uid);
        } catch (err) {
          console.error('saveWorkoutProgress', err);
        }
      };

      const updateWorkoutInDb = async (workoutId, workoutData) => {
        if (!user) return;
        try {
          await db.collection('users').doc(user.uid).collection('workouts').doc(workoutId).update({
            ...workoutData,
            updated: new Date().toISOString()
          });
          loadData(user.uid);
        } catch (err) {
          console.error('updateWorkoutInDb', err);
        }
      };

      const deleteWorkout = async (workoutId) => {
        if (!user || !confirm('Delete this workout?')) return;
        try {
          await db.collection('users').doc(user.uid).collection('workouts').doc(workoutId).delete();
          setWorkouts(w => w.filter(x => x.id !== workoutId));
        } catch (err) {
          console.error('deleteWorkout', err);
        }
      };

      const resumeWorkout = (workoutData) => {
        setWorkout({
          name: workoutData.name,
          start: new Date().toISOString(),
          resumedFrom: workoutData.id,
          exercises: workoutData.exercises.map(ex => ({
            ...ex,
            done: ex.done || Array(ex.sets).fill(false),
            weights: ex.weights || Array(ex.sets).fill(''),
            reps2: ex.reps2 || Array(ex.sets).fill('')
          }))
        });
        setResumingWorkout(true);
        setView('workout');
      };

      const startWorkoutFromTemplate = (templateKey) => {
        const temp = templates[templateKey];
        if (!temp) return;
        const w = {
          name: temp.name,
          start: new Date().toISOString(),
          exercises: (temp.exercises || []).map(ex => ({
            ...ex,
            done: Array(ex.sets).fill(false),
            weights: Array(ex.sets).fill(''),
            reps2: Array(ex.sets).fill('')
          }))
        };
        setWorkout(w);
        setView('workout');
      };

      const finishWorkout = async (markComplete = true) => {
        if (!workout) return;
        const endTime = new Date().toISOString();
        const toSave = { ...workout, end: endTime, inProgress: false };
        await saveWorkoutToDb(toSave);
        setWorkout(null);
        setResumingWorkout(false);
        setView('home');
      };

      const handleAuth = async (e) => {
        e.preventDefault();
        try {
          if (authMode === 'login') {
            await auth.signInWithEmailAndPassword(email, password);
          } else {
            await auth.createUserWithEmailAndPassword(email, password);
          }
          setEmail('');
          setPassword('');
        } catch (err) {
          alert(err.message);
        }
      };

      const handleLogout = async () => {
        await auth.signOut();
        setTemplates(DEFAULT);
        setWorkouts([]);
        setView('home');
      };

      useEffect(() => {
        if (!timer.active || timer.left <= 0) return;
        const id = setInterval(() => {
          setTimer(t => {
            if (t.left <= 1) {
              playSound('complete');
              return { ...t, left: 0, active: false };
            }
            return { ...t, left: t.left - 1 };
          });
        }, 1000);
        return () => clearInterval(id);
      }, [timer.active, timer.left]);

      const playSound = (type = 'complete') => {
        try {
          const ctx = new (window.AudioContext || window.webkitAudioContext)();
          const now = ctx.currentTime;
          if (type === 'complete') {
            for (let i = 0; i < 3; i++) {
              const o = ctx.createOscillator();
              const g = ctx.createGain();
              o.connect(g);
              g.connect(ctx.destination);
              o.type = 'sine';
              o.frequency.setValueAtTime(700 + i * 200, now + i * 0.12);
              g.gain.setValueAtTime(0.2, now + i * 0.12);
              o.start(now + i * 0.12);
              o.stop(now + i * 0.12 + 0.1);
            }
          } else {
            const o = ctx.createOscillator();
            const g = ctx.createGain();
            o.connect(g);
            g.connect(ctx.destination);
            o.frequency.value = 880;
            g.gain.setValueAtTime(0.2, now);
            o.start(now);
            o.stop(now + 0.2);
          }
        } catch (e) {
          console.warn('Audio failed', e);
        }
      };

      const getAllExercises = () => {
        const all = [];
        Object.values(EXERCISES).forEach(list => all.push(...list));
        return all;
      };

      const getVideoId = (url) => {
        if (!url) return null;
        const s = String(url).trim();
        if (s.includes('youtube.com/embed/')) {
          const [path, query] = s.split('?');
          const id = path.split('embed/')[1].split('/')[0];
          const params = query ? `?${query}` : '';
          return { type: 'youtube', id, params };
        }
        if (s.includes('youtube.com/watch') && s.includes('v=')) {
          const id = s.split('v=')[1].split('&')[0].split('#')[0];
          return { type: 'youtube', id, params: '' };
        }
        if (s.includes('youtu.be/')) {
          const id = s.split('youtu.be/')[1].split('?')[0].split('&')[0];
          return { type: 'youtube', id, params: '' };
        }
        if (s.includes('vimeo.com')) {
          const match = s.match(/vimeo\.com\/(\d+)/);
          if (match) return { type: 'vimeo', id: match[1], params: '' };
        }
        if (s.includes('drive.google.com')) {
          const match = s.match(/\/d\/([^\/]+)/);
          if (match) return { type: 'drive', id: match[1], params: '' };
        }
        return null;
      };

      // LOADING
      if (loading) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center">
            <div className="text-white text-2xl">Loading...</div>
          </div>
        );
      }

      // AUTH
      if (!user) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center p-4">
            <div className="bg-white rounded-lg shadow-2xl p-8 max-w-md w-full">
              <div className="flex items-center justify-center gap-3 mb-6">
                <Dumbbell className="w-12 h-12 text-indigo-600" />
                <h1 className="text-3xl font-bold text-gray-800">Workout Tracker</h1>
              </div>

              <form onSubmit={handleAuth} className="space-y-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Email</label>
                  <input type="email" value={email} onChange={(e) => setEmail(e.target.value)} required className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" />
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Password</label>
                  <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} required minLength="6" className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" />
                </div>

                <button type="submit" className="w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 font-semibold">
                  {authMode === 'login' ? 'Sign In' : 'Sign Up'}
                </button>
              </form>

              <div className="mt-4 text-center">
                <button onClick={() => setAuthMode(authMode === 'login' ? 'signup' : 'login')} className="text-indigo-600 hover:text-indigo-800 text-sm">
                  {authMode === 'login' ? 'Need an account? Sign up' : 'Have an account? Sign in'}
                </button>
              </div>

              <div className="mt-6 text-xs text-gray-500 text-center space-y-1">
                <p>âœ… Sync across all devices</p>
                <p>âœ… Track last workout data</p>
                <p>âœ… Week-by-week progress</p>
              </div>
            </div>
          </div>
        );
      }

      // EDIT TEMPLATE view is already provided above; here we continue home/workout UI

      // WORKOUT view
      if (view === 'workout' && workout) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
            <div className="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-6">
              <div className="flex justify-between items-center mb-4">
                <h1 className="text-2xl font-bold text-gray-800 flex items-center gap-2"><Dumbbell className="w-6 h-6 text-indigo-600" />{workout.name}</h1>
                <div className="flex gap-2">
                  <button onClick={() => { setView('home'); setWorkout(null); }} className="bg-gray-600 text-white px-3 py-1 rounded">Exit</button>
                  <button onClick={() => finishWorkout()} className="bg-green-600 text-white px-3 py-1 rounded">Finish & Save</button>
                </div>
              </div>

              <div className="space-y-4">
                {(workout.exercises || []).map((ex, i) => (
                  <div key={i} className="border rounded p-4">
                    <div className="flex justify-between items-center mb-2">
                      <div>
                        <div className="font-semibold text-gray-800">{ex.name}</div>
                        <div className="text-sm text-gray-500">{ex.sets} Ã— {ex.reps}</div>
                      </div>
                      <div className="text-sm text-gray-500">{ex.instructions ? 'ðŸ“‹' : ''} {ex.videoUrl ? 'ðŸ“¹' : ''}</div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-2">
                      {Array.from({ length: ex.sets }).map((_, j) => (
                        <div key={j} className="flex items-center gap-2">
                          <input
                            type="checkbox"
                            checked={ex.done?.[j] || false}
                            onChange={(e) => {
                              const copy = { ...workout };
                              if (!copy.exercises[i].done) copy.exercises[i].done = Array(ex.sets).fill(false);
                              copy.exercises[i].done[j] = e.target.checked;
                              setWorkout(copy);
                            }}
                            className="w-5 h-5"
                          />
                          <span className="text-sm w-16">Set {j + 1}</span>
                          <input
                            type="number"
                            placeholder="Weight"
                            value={ex.weights?.[j] || ''}
                            onChange={(e) => {
                              const copy = { ...workout };
                              if (!copy.exercises[i].weights) copy.exercises[i].weights = Array(ex.sets).fill('');
                              copy.exercises[i].weights[j] = e.target.value;
                              setWorkout(copy);
                            }}
                            className="w-20 px-2 py-1 border rounded text-sm"
                          />
                          <span className="text-xs">lbs Ã—</span>
                          <input
                            type="number"
                            placeholder="Reps"
                            value={ex.reps2?.[j] || ''}
                            onChange={(e) => {
                              const copy = { ...workout };
                              if (!copy.exercises[i].reps2) copy.exercises[i].reps2 = Array(ex.sets).fill('');
                              copy.exercises[i].reps2[j] = e.target.value;
                              setWorkout(copy);
                            }}
                            className="w-16 px-2 py-1 border rounded text-sm"
                          />
                        </div>
                      ))}
                    </div>
                  </div>
                ))}
              </div>

              <div className="mt-4 flex items-center gap-2">
                <input type="number" value={timer.time} onChange={(e) => setTimer({ ...timer, time: Number(e.target.value) })} className="w-20 px-2 py-1 border rounded" />
                <button onClick={() => setTimer({ ...timer, left: timer.time, active: true })} className="bg-indigo-600 text-white px-3 py-1 rounded">Start Rest</button>
                <div className="ml-auto flex items-center gap-2">
                  <div className="text-sm text-gray-600">Timer: {timer.left}s {timer.active ? '(running)' : ''}</div>
                </div>
              </div>

              <div className="mt-4 text-sm text-gray-500">Tip: Check sets done, fill weights/reps, then Finish & Save.</div>
            </div>
          </div>
        );
      }

      // CREATE TEMPLATE view
      if (view === 'createTemplate' || showNewTemplate) {
        const allExercises = getAllExercises();
        return (
          <div className="min-h-screen bg-slate-900 p-4">
            <div className="max-w-4xl mx-auto bg-slate-800 rounded-lg p-6">
              <div className="flex justify-between mb-6">
                <h1 className="text-2xl font-bold text-white">Create New Template</h1>
                <button onClick={() => { setShowNewTemplate(false); setNewTemplate({ name: '', exercises: [] }); setView('home'); }} className="text-gray-400 text-2xl">âœ•</button>
              </div>

              <div className="bg-slate-700 rounded-lg p-4 mb-4">
                <label className="text-white font-semibold block mb-2">Template Name</label>
                <input
                  type="text"
                  placeholder="e.g., Upper Body, Full Body, etc."
                  value={newTemplate.name}
                  onChange={(e) => setNewTemplate({ ...newTemplate, name: e.target.value })}
                  className="w-full px-3 py-2 bg-slate-600 text-white rounded"
                />
              </div>

              <div className="mb-4">
                <h3 className="text-white font-semibold mb-2">Add Exercises</h3>
                <div className="space-y-2 max-h-48 overflow-y-auto">
                  {allExercises.map((ex, i) => (
                    <button key={i} onClick={() => {
                      setNewTemplate(t => ({ ...t, exercises: [...t.exercises, { ...ex }] }));
                    }} className="w-full text-left bg-slate-700 hover:bg-slate-600 rounded p-2 flex justify-between items-center">
                      <div>
                        <div className="text-white">{ex.name}</div>
                        <div className="text-xs text-gray-400">{ex.sets}Ã—{ex.reps}</div>
                      </div>
                      <div className="text-gray-300">Add</div>
                    </button>
                  ))}
                </div>
              </div>

              <div className="mb-4">
                <h3 className="text-white font-semibold mb-2">Preview</h3>
                <div className="space-y-2">
                  {newTemplate.exercises.map((ex, i) => (
                    <div key={i} className="bg-slate-700 rounded p-2 flex justify-between items-center">
                      <div>
                        <div className="text-white text-sm">{ex.name}</div>
                        <div className="text-xs text-gray-400">{ex.sets}Ã—{ex.reps}</div>
                      </div>
                      <div className="flex gap-2">
                        <button onClick={() => {
                          setNewTemplate(t => ({ ...t, exercises: t.exercises.filter((_, idx) => idx !== i) }));
                        }} className="text-red-400">Remove</button>
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              <div className="flex gap-2">
                <button onClick={() => {
                  if (!newTemplate.name) { alert('Please provide a template name'); return; }
                  const key = newTemplate.name.replace(/\s+/g, '').toLowerCase();
                  const newTemplates = { ...templates, [key]: { name: newTemplate.name, exercises: newTemplate.exercises } };
                  saveTemplates(newTemplates);
                  setNewTemplate({ name: '', exercises: [] });
                  setShowNewTemplate(false);
                  setView('home');
                }} className="flex-1 bg-green-600 text-white py-2 rounded">Create Template</button>
                <button onClick={() => { setNewTemplate({ name: '', exercises: [] }); setView('home'); }} className="flex-1 bg-slate-600 text-white py-2 rounded">Cancel</button>
              </div>
            </div>
          </div>
        );
      }

      // HOME view
      if (view === 'home') {
        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
            <div className="max-w-6xl mx-auto">
              <div className="flex justify-between items-center mb-6">
                <div className="flex items-center gap-4">
                  <Dumbbell className="w-10 h-10 text-indigo-600" />
                  <div>
                    <h1 className="text-2xl font-bold text-gray-800">Workout Tracker</h1>
                    <div className="text-sm text-gray-500">90-day log Â· {workouts.length} workouts</div>
                  </div>
                </div>
                <div className="flex gap-2">
                  <button onClick={() => setView('progress')} className="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 flex items-center gap-2"><BarChart className="w-5 h-5" />Progress</button>
                  <button onClick={() => setShowNewTemplate(true) || setView('createTemplate')} className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 flex items-center gap-2"><Plus />Template</button>
                  <button onClick={handleLogout} className="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 flex items-center gap-2"><LogOut />Logout</button>
                </div>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <h2 className="text-lg font-semibold text-gray-700 mb-3">Templates</h2>
                  <div className="space-y-3">
                    {Object.entries(templates).map(([key, t]) => (
                      <div key={key} className="bg-white rounded-lg shadow p-4 flex justify-between items-center">
                        <div>
                          <div className="font-semibold text-gray-800">{t.name}</div>
                          <div className="text-xs text-gray-500">{(t.exercises || []).length} exercises</div>
                        </div>
                        <div className="flex gap-2">
                          <button onClick={() => startWorkoutFromTemplate(key)} className="bg-indigo-600 text-white px-3 py-1 rounded hover:bg-indigo-700">Start</button>
                          <button onClick={() => { setEditing({ ...t, key, isDefault: Object.keys(DEFAULT).includes(key) }); setView('edit'); }} className="bg-gray-600 text-white px-3 py-1 rounded">Edit</button>
                          {!Object.keys(DEFAULT).includes(key) && (
                            <button onClick={() => deleteTemplate(key)} className="bg-red-500 text-white px-3 py-1 rounded">Delete</button>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                </div>

                <div>
                  <h2 className="text-lg font-semibold text-gray-700 mb-3">Recent Workouts</h2>
                  <div className="space-y-3">
                    {workouts.length === 0 && (
                      <div className="bg-white rounded-lg shadow p-6 text-center text-gray-500">No workouts yet â€” start one from a template</div>
                    )}
                    {workouts.map(w => (
                      <div key={w.id} className="bg-white rounded-lg shadow p-4 flex justify-between items-center">
                        <div>
                          <div className="font-semibold">{w.name}</div>
                          <div className="text-xs text-gray-500">{new Date(w.start).toLocaleString()}</div>
                        </div>
                        <div className="flex gap-2">
                          <button onClick={() => resumeWorkout(w)} className="bg-indigo-600 text-white px-3 py-1 rounded">Resume</button>
                          <button onClick={() => { setEditingWorkout(w); }} className="bg-gray-600 text-white px-3 py-1 rounded">Edit</button>
                          <button onClick={() => deleteWorkout(w.id)} className="bg-red-500 text-white px-3 py-1 rounded">Delete</button>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>

            </div>
          </div>
        );
      }

      // fallback
      return <div className="p-4">Unknown view</div>;
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
